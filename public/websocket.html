<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket 测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
            padding: 40px 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border: 1px solid #ddd;
        }

        h1 {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: normal;
        }

        .status {
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            font-size: 14px;
        }

        .status.connected {
            background: #f0fff0;
            border-color: #0a0;
            color: #0a0;
        }

        .status.disconnected {
            background: #fff0f0;
            border-color: #d00;
            color: #d00;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            font-size: 14px;
        }

        input:focus {
            outline: none;
            border-color: #999;
        }

        button {
            padding: 10px 20px;
            font-size: 14px;
            border: 1px solid #ddd;
            background: #333;
            color: white;
            cursor: pointer;
        }

        button:hover:not(:disabled) {
            background: #555;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .messages {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }

        .messages h2 {
            font-size: 16px;
            font-weight: normal;
            margin-bottom: 15px;
        }

        .message {
            padding: 10px;
            margin-bottom: 10px;
            background: #f5f5f5;
            font-size: 14px;
            font-family: 'Courier New', monospace;
        }

        .message.sent {
            background: #e3f2fd;
        }

        .message.received {
            background: #f0f4c3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebSocket 测试</h1>

        <div class="status disconnected" id="status">未连接</div>

        <div class="form-group">
            <label>消息</label>
            <input type="text" id="messageInput" placeholder="输入消息">
        </div>

        <button onclick="sendMessage()" id="sendBtn" disabled>发送</button>

        <div class="messages">
            <h2>消息记录</h2>
            <div id="messageList"></div>
        </div>
    </div>

    <!-- 方式1: 使用服务端自动提供的文件（推荐） -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- 方式2: 使用CDN（备选）
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    -->
    
    <script>
        let socket = null;
        const statusEl = document.getElementById('status');
        const sendBtn = document.getElementById('sendBtn');
        const messageInput = document.getElementById('messageInput');
        const messageList = document.getElementById('messageList');

        // 连接WebSocket
        function connect() {
            socket = io('http://localhost:9009');

            // 连接成功
            socket.on('connect', () => {
                console.log('连接成功:', socket.id);
                statusEl.textContent = '已连接 (ID: ' + socket.id + ')';
                statusEl.className = 'status connected';
                sendBtn.disabled = false;
                addMessage('系统', '连接成功');
            });

            // 断开连接
            socket.on('disconnect', () => {
                console.log('连接断开');
                statusEl.textContent = '连接断开';
                statusEl.className = 'status disconnected';
                sendBtn.disabled = true;
                addMessage('系统', '连接断开');
            });

            // 接收消息
            socket.on('message', (data) => {
                console.log('收到消息:', data);
                addMessage('服务器', data, 'received');
            });
        }

        // 发送消息
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            console.log('发送消息:', message);
            addMessage('我', message, 'sent');
            
            // 发送到服务器
            socket.emit('message', message);
            
            messageInput.value = '';
        }

        // 添加消息到列表
        function addMessage(from, text, type = '') {
            const messageEl = document.createElement('div');
            messageEl.className = 'message ' + type;
            messageEl.textContent = `[${from}] ${text}`;
            messageList.appendChild(messageEl);
            messageList.scrollTop = messageList.scrollHeight;
        }

        // 回车发送
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // 页面加载时自动连接
        connect();
    </script>
</body>
</html>

